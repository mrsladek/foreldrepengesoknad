{"version":3,"file":"ManglendeVedlegg.stories-3f0eeed1.js","sources":["../../src/app/steps/manglende-vedlegg/manglendeVedleggFormConfig.ts","../../src/app/steps/manglende-vedlegg/manglendeVedleggQuestionsConfig.ts","../../src/app/steps/manglende-vedlegg/manglendeVedleggFormUtils.ts","../../src/app/steps/manglende-vedlegg/ManglendeVedlegg.tsx"],"sourcesContent":["import { getTypedFormComponents } from '@navikt/sif-common-formik/lib';\nimport { Attachment } from 'app/types/Attachment';\n\nexport enum ManglendeVedleggFormField {\n    vedlegg = 'vedlegg',\n}\n\nexport interface ManglendeVedleggFormData {\n    [ManglendeVedleggFormField.vedlegg]: Attachment[][];\n}\n\nexport const ManglendeVedleggFormComponents = getTypedFormComponents<\n    ManglendeVedleggFormField,\n    ManglendeVedleggFormData,\n    string\n>();\n","import { QuestionConfig, Questions } from '@navikt/sif-common-question-config';\nimport { ManglendeVedleggFormData, ManglendeVedleggFormField } from './manglendeVedleggFormConfig';\nimport { AttachmentType } from 'app/types/AttachmentType';\n\ninterface ManglendeVedleggQuestionsPayload extends ManglendeVedleggFormData {\n    manglendeVedleggTyper: AttachmentType[];\n    erLikEllerMindreEnnFireUkerTilUttaketStarter: boolean;\n}\n\nconst ManglendeVedleggFormConfig: QuestionConfig<ManglendeVedleggQuestionsPayload, ManglendeVedleggFormField> = {\n    [ManglendeVedleggFormField.vedlegg]: {\n        isAnswered: ({ vedlegg, manglendeVedleggTyper, erLikEllerMindreEnnFireUkerTilUttaketStarter }) =>\n            erLikEllerMindreEnnFireUkerTilUttaketStarter\n                ? true\n                : manglendeVedleggTyper.every((type) =>\n                      vedlegg\n                          .filter((vedlegg) => !!vedlegg)\n                          .flat()\n                          .some((v) => v.type === type)\n                  ),\n        isIncluded: () => true,\n    },\n};\n\nexport const manglendeVedleggQuestionsConfig = Questions<ManglendeVedleggQuestionsPayload, ManglendeVedleggFormField>(\n    ManglendeVedleggFormConfig\n);\n","import { ManglendeVedleggFormData, ManglendeVedleggFormField } from './manglendeVedleggFormConfig';\n\nexport const getInitValues = (): Readonly<ManglendeVedleggFormData> => ({\n    [ManglendeVedleggFormField.vedlegg]: [],\n});\n","import { Block, formatDate, intlUtils, Step, UtvidetInformasjon } from '@navikt/fp-common';\nimport SøknadRoutes from 'app/routes/routes';\nimport { Hovedknapp } from 'nav-frontend-knapper';\nimport _ from 'lodash';\nimport React from 'react';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { isInfoPeriode, Periode } from 'uttaksplan/types/Periode';\nimport useOnValidSubmit from 'app/utils/hooks/useOnValidSubmit';\nimport useSøknad from 'app/utils/hooks/useSøknad';\nimport useAvbrytSøknad from 'app/utils/hooks/useAvbrytSøknad';\nimport stepConfig, { getPreviousStepHref, getPreviousStepHrefEndringssøknad } from '../stepsConfig';\nimport {\n    ManglendeVedleggFormComponents,\n    ManglendeVedleggFormData,\n    ManglendeVedleggFormField,\n} from './manglendeVedleggFormConfig';\nimport dayjs from 'dayjs';\nimport { manglendeVedleggQuestionsConfig } from './manglendeVedleggQuestionsConfig';\nimport Veilederpanel from 'nav-frontend-veilederpanel';\nimport VeilederNormal from 'app/assets/VeilederNormal';\nimport { sorterPerioder } from '../uttaksplan-info/utils/Periodene';\nimport { finnSendSenereVedlegg, isAttachmentForPeriode } from './util';\nimport { AttachmentType } from 'app/types/AttachmentType';\nimport { Normaltekst, Element } from 'nav-frontend-typografi';\nimport FormikFileUploader from 'app/components/formik-file-uploader/FormikFileUploader';\nimport { isAnnenForelderOppgitt } from 'app/context/types/AnnenForelder';\nimport { getInitValues } from './manglendeVedleggFormUtils';\nimport { FieldArray } from 'formik';\nimport { storeAppState } from 'app/utils/submitUtils';\nimport { ForeldrepengesøknadContextState } from 'app/context/ForeldrepengesøknadContextConfig';\nimport useFortsettSøknadSenere from 'app/utils/hooks/useFortsettSøknadSenere';\nimport useSaveLoadedRoute from 'app/utils/hooks/useSaveLoadedRoute';\n\nexport const attenUkerPluss3Number = 18 * 7 + 3;\n\nconst getManglendeVedleggValues = (type: AttachmentType, fornavnAnnenForelder: string) => {\n    return type === AttachmentType.MORS_AKTIVITET_DOKUMENTASJON\n        ? {\n              navn: fornavnAnnenForelder,\n          }\n        : undefined;\n};\n\nconst lagSti = (stiDeler: string[]) => {\n    const sti = stiDeler.reduce((formatertSti, del) => {\n        return isNaN(+del) ? formatertSti + '.' + del : formatertSti + '[' + del + ']';\n    }, '');\n    return sti.replace('.søknad.', '');\n};\n\nconst ManglendeVedlegg: React.FunctionComponent = () => {\n    const intl = useIntl();\n    const søknad = useSøknad();\n    const { uttaksplan, erEndringssøknad } = søknad;\n\n    const alleSendSenereVedlegg = finnSendSenereVedlegg(søknad);\n    const alleStierMedManglendeVedlegg = Array.from(alleSendSenereVedlegg.keys());\n\n    const onValidSubmitHandler = (values: Partial<ManglendeVedleggFormData>) => {\n        values.vedlegg!.forEach((vedlegg, index) => {\n            if (vedlegg) {\n                const sti = lagSti(alleStierMedManglendeVedlegg[index].split('.'));\n                _.set(søknad, sti, vedlegg);\n            }\n        });\n\n        //TODO (TOR) Om ein skal gjera det på denne måten må ein laga ei djup klone av søknad og så ein updateSøknad actionCreator\n        //Utan djup klone gir det liten meining å kalla actionCreator\n        return [\n            /*actionCreator.setVedlegg(stiOgVedlegg)*/\n        ];\n    };\n\n    const { handleSubmit, isSubmitting } = useOnValidSubmit(\n        onValidSubmitHandler,\n        SøknadRoutes.OPPSUMMERING,\n        (state: ForeldrepengesøknadContextState) => storeAppState(state)\n    );\n    const onAvbrytSøknad = useAvbrytSøknad();\n    const onFortsettSøknadSenere = useFortsettSøknadSenere();\n\n    const fornavnAnnenForelder = isAnnenForelderOppgitt(søknad.annenForelder) ? søknad.annenForelder.fornavn : '';\n\n    const førsteUttaksEllerUttsettelsesPeriode = uttaksplan\n        .filter((p: Periode) => p.tidsperiode.fom !== undefined && !isInfoPeriode(p))\n        .sort(sorterPerioder)\n        .shift();\n\n    const erLikEllerMindreEnnFireUkerTilUttaketStarter =\n        førsteUttaksEllerUttsettelsesPeriode !== undefined &&\n        dayjs(førsteUttaksEllerUttsettelsesPeriode.tidsperiode.fom).isSameOrBefore(dayjs().add(4, 'weeks'), 'day');\n\n    const manglendeVedleggTyper = Array.from(alleSendSenereVedlegg.values()).map((v) => v.type);\n    useSaveLoadedRoute(SøknadRoutes.MANGLENDE_VEDLEGG);\n\n    return (\n        <ManglendeVedleggFormComponents.FormikWrapper\n            initialValues={getInitValues()}\n            onSubmit={handleSubmit}\n            renderForm={({ values: formValues }) => {\n                const visibility = manglendeVedleggQuestionsConfig.getVisbility({\n                    ...formValues,\n                    manglendeVedleggTyper,\n                    erLikEllerMindreEnnFireUkerTilUttaketStarter,\n                });\n\n                return (\n                    <Step\n                        bannerTitle={intlUtils(intl, 'søknad.pageheading')}\n                        backLinkHref={\n                            erEndringssøknad\n                                ? getPreviousStepHrefEndringssøknad('dokumentasjon')\n                                : getPreviousStepHref('dokumentasjon')\n                        }\n                        activeStepId=\"dokumentasjon\"\n                        pageTitle={intlUtils(intl, 'søknad.manglendeVedlegg')}\n                        stepTitle={intlUtils(intl, 'søknad.manglendeVedlegg')}\n                        onCancel={onAvbrytSøknad}\n                        onContinueLater={onFortsettSøknadSenere}\n                        steps={stepConfig(intl)}\n                        kompakt={true}\n                    >\n                        <ManglendeVedleggFormComponents.Form includeButtons={false}>\n                            <Block padBottom=\"l\">\n                                <Veilederpanel fargetema=\"normal\" svg={<VeilederNormal transparentBackground={true} />}>\n                                    <FormattedMessage\n                                        id={\n                                            erLikEllerMindreEnnFireUkerTilUttaketStarter\n                                                ? 'manglendeVedlegg.veileder'\n                                                : 'manglendeVedlegg.uttaksplan.advarsel.forTidligUtenDokumentasjon'\n                                        }\n                                    />\n                                </Veilederpanel>\n                            </Block>\n                            {alleStierMedManglendeVedlegg.map((keyISoknad, index) => {\n                                const key = keyISoknad.replace('søknad.', '');\n                                const periode = _.get(søknad, key.replace('.vedlegg', '').split('.'));\n\n                                const sendSenereVedlegg = alleSendSenereVedlegg.get(keyISoknad)!;\n                                if (sendSenereVedlegg.type === AttachmentType.SEN_ENDRING) {\n                                    return null;\n                                }\n                                return (\n                                    <Block\n                                        key={\n                                            sendSenereVedlegg.type +\n                                            periode?.tidsperiode?.fom +\n                                            periode?.tidsperiode?.tom\n                                        }\n                                    >\n                                        <Element>\n                                            {intlUtils(\n                                                intl,\n                                                `manglendeVedlegg.title.${sendSenereVedlegg.type}`,\n                                                getManglendeVedleggValues(sendSenereVedlegg.type, fornavnAnnenForelder)\n                                            )}\n                                        </Element>\n                                        <UtvidetInformasjon\n                                            apneLabel={intlUtils(\n                                                intl,\n                                                `manglendeVedlegg.apneLabel.${sendSenereVedlegg.type}`,\n                                                getManglendeVedleggValues(sendSenereVedlegg.type, fornavnAnnenForelder)\n                                            )}\n                                        >\n                                            <div style={{ backgroundColor: '#f1f1f1', padding: '1.5rem' }}>\n                                                <Normaltekst>\n                                                    {intlUtils(\n                                                        intl,\n                                                        `manglendeVedlegg.info.${sendSenereVedlegg.type}`,\n                                                        getManglendeVedleggValues(\n                                                            sendSenereVedlegg.type,\n                                                            fornavnAnnenForelder\n                                                        )\n                                                    )}\n                                                </Normaltekst>\n                                            </div>\n                                        </UtvidetInformasjon>\n                                        {periode?.tidsperiode && periode?.type && (\n                                            <Block margin=\"l\">\n                                                <Normaltekst>\n                                                    {intlUtils(\n                                                        intl,\n                                                        isAttachmentForPeriode(sendSenereVedlegg.type)\n                                                            ? 'manglendeVedlegg.uttak.periode.tidsperiode'\n                                                            : 'manglendeVedlegg.periode.tidsperiode',\n                                                        {\n                                                            type: intlUtils(\n                                                                intl,\n                                                                sendSenereVedlegg.type === AttachmentType.ANNEN_INNTEKT\n                                                                    ? `inntektstype.${periode.type.toLowerCase()}`\n                                                                    : periode.type\n                                                            ),\n                                                            fom: formatDate(periode.tidsperiode.fom),\n                                                            tom: periode.tidsperiode.tom\n                                                                ? formatDate(periode.tidsperiode.tom)\n                                                                : '-',\n                                                        }\n                                                    )}\n                                                </Normaltekst>\n                                            </Block>\n                                        )}\n                                        <FieldArray\n                                            name={ManglendeVedleggFormField.vedlegg}\n                                            render={() => {\n                                                return (\n                                                    <FormikFileUploader\n                                                        key={`${ManglendeVedleggFormField.vedlegg}.${index}`}\n                                                        name={`${ManglendeVedleggFormField.vedlegg}.${index}`}\n                                                        label={intlUtils(\n                                                            intl,\n                                                            'manglendeVedlegg.lastopp.manglende.vedlegg'\n                                                        )}\n                                                        attachments={\n                                                            formValues.vedlegg.length > index &&\n                                                            formValues.vedlegg[index]\n                                                                ? formValues.vedlegg[index]\n                                                                : []\n                                                        }\n                                                        attachmentType={sendSenereVedlegg.type}\n                                                        skjemanummer={sendSenereVedlegg.skjemanummer}\n                                                    />\n                                                );\n                                            }}\n                                        />\n                                    </Block>\n                                );\n                            })}\n                            <Block visible={visibility.areAllQuestionsAnswered()} textAlignCenter={true}>\n                                <Hovedknapp disabled={isSubmitting} spinner={isSubmitting}>\n                                    {intlUtils(intl, 'søknad.gåVidere')}\n                                </Hovedknapp>\n                            </Block>\n                        </ManglendeVedleggFormComponents.Form>\n                    </Step>\n                );\n            }}\n        />\n    );\n};\n\nexport default ManglendeVedlegg;\n"],"names":["ManglendeVedleggFormField","ManglendeVedleggFormComponents","getTypedFormComponents","ManglendeVedleggFormConfig","vedlegg","manglendeVedleggTyper","erLikEllerMindreEnnFireUkerTilUttaketStarter","type","v","manglendeVedleggQuestionsConfig","Questions","getInitValues","getManglendeVedleggValues","fornavnAnnenForelder","AttachmentType","lagSti","stiDeler","formatertSti","del","ManglendeVedlegg","intl","useIntl","søknad","useSøknad","uttaksplan","erEndringssøknad","alleSendSenereVedlegg","finnSendSenereVedlegg","alleStierMedManglendeVedlegg","onValidSubmitHandler","values","index","sti","_","handleSubmit","isSubmitting","useOnValidSubmit","SøknadRoutes","state","storeAppState","onAvbrytSøknad","useAvbrytSøknad","onFortsettSøknadSenere","useFortsettSøknadSenere","isAnnenForelderOppgitt","førsteUttaksEllerUttsettelsesPeriode","p","isInfoPeriode","sorterPerioder","dayjs","useSaveLoadedRoute","jsx","formValues","visibility","Step","intlUtils","getPreviousStepHrefEndringssøknad","getPreviousStepHref","stepConfig","jsxs","Block","Veilederpanel","VeilederNormal","FormattedMessage","keyISoknad","key","periode","sendSenereVedlegg","Element","UtvidetInformasjon","Normaltekst","isAttachmentForPeriode","formatDate","FieldArray","FormikFileUploader","_a","_b","Hovedknapp","ManglendeVedlegg$1"],"mappings":"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"}